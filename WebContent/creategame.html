<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Create Room</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type="text/css">


        body {
            background-color: lightpink;
            background-image: url("./images/background1.jpeg");
        }

        .create-room-content {
            display: flex;
            position: absolute;
            height: 85%;
            width: 60%;
            top: 70px;
            padding-top: 10px;
            background-color: white;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .create-room-option {
            position: relative;
            display: flex;
            height: 100px;
            width: 300px;
            background-color: none;
            flex-direction: column;
            justify-content: center;
        }

        .create-room-input {
            width: 50%;
        }



        #create-game-window {
            display: flex;
            position: absolute;
            top: 20px;
            bottom: 0px;
            width: 100%;
            margin: 0px auto;
            background-color: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #page-title {
            position: absolute;
            font-size: 14pt;
            left: 10px;
            top: 10px;
        }

        #file-input {
            position: absolute;
            top: 0px;
            border: none;
        }

        .image-preview {
            position: relative;
            height: 70%;
            width: 50%;
            left: 50%;
            background-color: #939ddb;
            opacity: 0.4;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .img-preview-img {
            max-height: 100%;
            max-width: 100%;
            position: absolute;
        }

        .option-label {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            color: dimgray;
        }

        ::-webkit-file-upload-button {
            padding: 6px;
            width: 100px;
            border: none;
            border-radius: 5px;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            background-color: #d4aed3;
            color: white;
        }

        #create-button {
            background-color: #939ddb;
            color: white;
            height: 55px;
            width: 300px;
            font-size: 18pt;
            font-weight: bold;
        }

        input[type=text] {
            height: 55px;
            width: 300px;
            font-size: 18pt;
            padding-left: 10px;
        }

        input::placeholder {
            text-align: center;
            color: lightgrey;
            font-size: 18pt;
        }

        #room-code {
            height: 65px;
        }
    </style>

</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-expand-md navbar-expand-sm navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="registeredHomePage.html">Anything</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-link" aria-current="page" href="registeredHomePage.html">Home</a>
                    <a class="nav-link" href="login.html">Logout</a>
                    <p class="heading nav-link" style="text-align: right; color: honeydew;margin:0px"></p>
                </div>
            </div>
        </div>
    </nav>
    <div id="create-game-window">
        
        <div class="create-room-content">
            <h1 id="page-title">Game Room Settings</h1>
            <div class="create-room-option">
                <label class="option-label" for="num-players" style="margin-top:20px;">Number of Players</label>
                <input type="text" id="num-players" class="create-room-input" placeholder="Number of Players" />
            </div>
            <div class="create-room-option">
                <label class="option-label" for="time-limit" style="">Time Limit (seconds?)</label>
                <input type="text" id="time-limit" class="create-room-input" placeholder="Time Limit" />
            </div>
            <div class="create-room-option">
                <label class="option-label" for="num-rounds" style="">Number of Rounds</label>
                <input type="text" id="num-rounds" class="create-room-input" placeholder="Number of Rounds" />
            </div>
            <div class="create-room-option">
                <input type="file" id="file-input" title="   " /> <br> <br>
                <div class="image-preview" id="imagePreview">
                    <!--<span class="img-preview-text">Image Preview</span>-->
                    <img src="" alt="Image Preview" id="image-preview" class="img-preview-img">
                </div>
            </div>
            <div class="create-room-option">
                <label class="option-label" for="room-code" style="">Room Code</label>
                <input type="text" id="room-code" class="create-room-input" placeholder="Room Code" />
            </div>
            <div class="create-room-option">
                <button class="btn" id="create-button" type="button" onclick="createRoom();">Create Room</button>
            </div>
        </div>


    </div>

    <script type="text/javascript">const imageUploadBtn = document.getElementById("file-input");
        const previewContainer = document.getElementById("imagePreview");
        const previewImage = previewContainer.querySelector(".img-preview-img");
        //const previewImageText = previewContainer.querySelector(".img-preview-text");
        var imageList = [];

        imageUploadBtn.addEventListener("change", function () {
            const file = this.files[0];

            if (file) {
                const reader = new FileReader();
                var imageURL;

                //previewImageText.style.display = "none";
                previewImage.style.display = "block";

                reader.addEventListener("load", function () {
                    previewImage.setAttribute("src", this.result);
                    console.log(this.result);
                    addImage(this.result);
                    
                });

                reader.readAsDataURL(file); 
                /* addImage(file); */
            }
        });


        function addImage(file) {
            imageList.push(file);
            console.log(imageList);
        }

        function createRoom() {
            console.log("Players: " + document.getElementById('num-players').value);
            console.log("Time: " + document.getElementById('time-limit').value);
            console.log("Rounds: " + document.getElementById('num-rounds').value);
            console.log("Room Code: " + document.getElementById('room-code').value);
            console.log("Images: " + imageList);
            
            let imageStr = "";
            for (let i = 0; i < imageList.length; i++) {
            	let concatStr = imageList[i].replace(/^data:image\/(png|jpeg);base64,/, "");
            	console.log("concat str" + concatStr);
            	imageStr += concatStr + ",";
           	}
            
            console.log("New Images: " + imageStr);
            
            $.ajax({
                url: "JoinRoomServlet",
                method: "POST",
                data: {
                    join_op : 'create',
                    maxPlayers: document.getElementById('num-players').value,
                    timeLimit: document.getElementById('time-limit').value,
                    rounds: document.getElementById('num-rounds').value,
                    images: imageStr
                },
                success : function (result) {
                    var resultObj = JSON.parse(result);
                    if (!resultObj.status) {
                        $(this).load("gamepage.html");
                    }
                    else {
                        alert("Unsuccessful Room Creation");
                    }
                }
            });
        }

        /*var image_preview_active = false;

        function previewImageClick() {
            img = document.getElementById('image-preview');
            img.style.transform = 'scale(5.0)';
            img.style.transition = 'transform 0.25s ease';
            previewContainer.style.opacity = 1;
            previewContainer.style.zIndex = 10;
            image_preview_active = true;
        }

        $(document).click(function (event) {
            console.log("outside image");
            var target = $(event.target);
            console.log(target.className);
            if (!target.closest('image-preview') && image_preview_active) {
                console.log("outside image");
                img.style.transform = 'scale(1.0)';
                previewContainer.style.opacity = '0.4';
                previewContainer.style.zIndex = 'initial';
                image_preview_active = false;
            }
        });*/</script>
        <script>
	        $.ajax({
	            method: "GET",
	            url: "https://api.weatherbit.io/v2.0/current?city=Los+Angeles,CA&key=99483e4de410460bbfebc63787746477&units=I",
	        })
	        .done(function(data) {
	            console.log(data);
	            displayResults(data);
	        })
	        .fail(function(result){
	            console.log(result.statusCode);
	            console.log("ERROR!!!!");
	        });
	
	        function displayResults(response){
	            let cloud1="";
	            if(response.data[0].clouds<50){
	                cloud1="Clear Sky";
	
	            }
	            else{
	                cloud1="Cloudy sky"
	            }
	
	            $(".heading").text("Today's weather in Los Angeles: "+response.data[0].temp+"° "+cloud1+". Feels like " + response.data[0].app_temp+"°");
	            
	        }
        
        </script>
</body>
</html>

